<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoX - Vertical Swipe Cards with Navigation</title>
  <link rel="stylesheet" href="shared/global.css" />
</head>
<body>

  <header class="header">
    <div class="logo">AutoX</div>
    <button class="hamburger" onclick="toggleMenu()" aria-label="Toggle menu">â˜°</button>
  </header>

  <main>
    <div class="carousel-wrapper">
      <section class="vertical-carousel" tabindex="0" aria-label="Services navigation">
        <article class="card" role="button" aria-pressed="false" data-type="service" tabindex="0" onclick="goToBooking('service')" onkeypress="if(event.key==='Enter'){goToBooking('service')}">
          <h2>ðŸ”§ Book a Service</h2>
          <p>Schedule routine maintenance for your car.</p>
          <button type="button" onclick="goToBooking('service')">Book Service</button>
        </article>

        <article class="card" role="button" aria-pressed="false" data-type="recovery" tabindex="0" onclick="goToBooking('recovery')" onkeypress="if(event.key==='Enter'){goToBooking('recovery')}">
          <h2>ðŸš¨ Emergency Recovery</h2>
          <p>Get quick help when your car breaks down.</p>
          <button type="button" onclick="goToBooking('recovery')">Request Recovery</button>
        </article>

        <article class="card" role="button" aria-pressed="false" data-type="inspection" tabindex="0" onclick="goToBooking('inspection')" onkeypress="if(event.key==='Enter'){goToBooking('inspection')}">
          <h2>ðŸ§° Diagnostics & Inspection</h2>
          <p>Mobile check-ups and fault diagnostics.</p>
          <button type="button" onclick="goToBooking('inspection')">Get Diagnostics</button>
        </article>
      </section>

      <nav class="carousel-nav" aria-label="Carousel Navigation">
        <button class="nav-arrow up" aria-label="Previous service">&#9650;</button>
        <div class="pagination-dots" role="tablist"></div>
        <button class="nav-arrow down" aria-label="Next service">&#9660;</button>
      </nav>
    </div>
  </main>

  <script>
    function toggleMenu() {
      alert("Menu clicked.");
    }

    function goToBooking(type) {
      window.location.href = `booking.html?type=${encodeURIComponent(type)}`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const carousel = document.querySelector(".vertical-carousel");
      const cards = Array.from(carousel.querySelectorAll(".card"));
      const paginationDots = document.querySelector(".pagination-dots");
      const btnUp = document.querySelector(".nav-arrow.up");
      const btnDown = document.querySelector(".nav-arrow.down");
      let currentIndex = 0;

      // Build pagination dots
      cards.forEach((card, i) => {
        const dot = document.createElement("button");
        dot.setAttribute("role", "tab");
        dot.setAttribute("aria-selected", i === 0 ? "true" : "false");
        dot.className = "dot";
        dot.addEventListener("click", () => scrollToCard(i));
        paginationDots.appendChild(dot);
      });

      const dots = Array.from(paginationDots.querySelectorAll(".dot"));

      function updateDots(index) {
        dots.forEach((dot, i) => {
          dot.setAttribute("aria-selected", i === index ? "true" : "false");
        });
      }

      function scrollToCard(index) {
        const card = cards[index];
        if (!card) return;
        card.scrollIntoView({ behavior: "smooth", block: "start" });
        currentIndex = index;
        updateDots(index);
      }

      btnUp.addEventListener("click", () => {
        if (currentIndex > 0) {
          scrollToCard(currentIndex - 1);
        }
      });

      btnDown.addEventListener("click", () => {
        if (currentIndex < cards.length - 1) {
          scrollToCard(currentIndex + 1);
        }
      });

      // Intersection Observer to update currentIndex on scroll
      const observerOptions = {
        root: carousel,
        threshold: 0.6,
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const index = cards.indexOf(entry.target);
            if (index !== -1) {
              currentIndex = index;
              updateDots(index);
            }
          }
        });
      }, observerOptions);

      cards.forEach((card) => observer.observe(card));

      // Keyboard support
      carousel.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") {
          e.preventDefault();
          if (currentIndex > 0) scrollToCard(currentIndex - 1);
        }
        if (e.key === "ArrowDown") {
          e.preventDefault();
          if (currentIndex < cards.length - 1) scrollToCard(currentIndex + 1);
        }
      });

      // Swipe support
      let startY = 0;
      let endY = 0;
      const minSwipeDistance = 50;

      carousel.addEventListener("touchstart", (e) => {
        startY = e.touches[0].clientY;
      });

      carousel.addEventListener("touchmove", (e) => {
        endY = e.touches[0].clientY;
      });

      carousel.addEventListener("touchend", () => {
        const distance = startY - endY;
        if (distance > minSwipeDistance) {
          if (currentIndex < cards.length - 1) scrollToCard(currentIndex + 1);
        } else if (distance < -minSwipeDistance) {
          if (currentIndex > 0) scrollToCard(currentIndex - 1);
        }
      });
    });
  </script>

</body>
</html>